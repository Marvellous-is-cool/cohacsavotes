<!-- views/admin/admin-dashboard.ejs -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
  </head>

  <body>
    <div class="container mt-4">
      <div class="row">
        <div class="col">
          <!-- Post Titles with Logout and Add Aspirant buttons -->
          <h4>Post Titles</h4>
          <div class="p-2">
            <a href="/logout" class="btn btn-danger btn-sm">Logout</a>
            <a href="/admin/dashboard/overview" class="btn btn-primary btn-sm"
              >Overview</a
            >
            <a href="/admin/add-aspirant" class="btn btn-primary btn-sm"
              >Add Aspirant</a
            >
          </div>
          <ul class="list-group">
            <% posts.forEach(post => { %>
            <li class="list-group-item">
              <div
                class="card-header"
                data-toggle="collapse"
                data-target="#post<%= post.id %>Collapse"
                aria-expanded="true"
                aria-controls="post<%= post.id %>Collapse"
              >
                <%= post.title %>
              </div>
              <!-- Display Aspirants for the Post -->
              <div id="post<%= post.id %>Collapse" class="collapse">
                <ul class="list-group mt-2">
                  <% if (post.aspirants && post.aspirants.length > 0) { %> <%
                  post.aspirants.forEach(aspirant => { %>
                  <li class="list-group-item">
                    <div class="card">
                      <img
                        src="/uploads/<%= aspirant.photo_url %>"
                        class="card-img-top"
                        alt="<%= aspirant.nickname %>"
                      />
                      <div class="card-body">
                        <h5 class="card-title"><%= aspirant.nickname %></h5>
                        <p class="card-text"><%= aspirant.level %></p>
                        <form
                          action="/admin/delete-aspirant/<%= post.id %>/<%= aspirant.id %>"
                          method="post"
                          onsubmit="return confirm('Are you sure you want to delete this aspirant?');"
                        >
                          <button type="submit" class="btn btn-danger btn-sm">
                            Delete
                          </button>
                        </form>

                        <a
                          href="/admin/edit-aspirant/<%= post.id %>/<%= aspirant.id %>"
                          class="btn btn-primary btn-sm"
                        >
                          Edit
                        </a>
                      </div>
                    </div>
                  </li>
                  <% }); %> <% } else { %>
                  <li class="list-group-item">No aspirants for this post.</li>
                  <% } %>
                </ul>
              </div>
            </li>
            <% }); %>
          </ul>
        </div>
      </div>
    </div>
    <% include('footer') %> <% if (typeof attachBeforeUnload !== 'undefined' &&
    attachBeforeUnload) { %>
    <script>
      // Attach an event listener for beforeunload to trigger session destruction
      window.addEventListener("beforeunload", async () => {
        await fetch("/admin/destroy-session", { method: "POST" });
      });
    </script>
    <% } %>
    <!-- Bootstrap JS and jQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  </body>
</html>

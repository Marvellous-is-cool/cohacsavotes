<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Overview</title>
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <!-- Font Awesome CSS for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div class="container mt-5">
      <div class="row p-3">
        <button class="btn btn-dark">
          <a href="/admin/dashboard" class="text-white">Back</a>
        </button>
        <h1 class="h1 text-dark col-10">Overview</h1>
      </div>
      <!-- Nav tabs -->
      <ul class="nav nav-tabs" id="adminTabs" role="tablist">
        <li class="nav-item">
          <a
            class="nav-link active"
            id="section1-tab"
            data-toggle="tab"
            href="#section1"
            role="tab"
            aria-controls="section1"
            aria-selected="true"
            >Post Titles and Aspirant Votes</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            id="section2-tab"
            data-toggle="tab"
            href="#section2"
            role="tab"
            aria-controls="section2"
            aria-selected="false"
            >Analysis</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            id="section3-tab"
            data-toggle="tab"
            href="#section3"
            role="tab"
            aria-controls="section3"
            aria-selected="false"
            >Participants</a
          >
        </li>
      </ul>

      <!-- Tab panes -->
      <div class="tab-content mt-2">
        <!-- Section 1: Post Titles and Aspirant Votes -->
        <div
          class="tab-pane fade show active"
          id="section1"
          role="tabpanel"
          aria-labelledby="section1-tab"
        >
          <h2>Post Titles and Aspirant Votes</h2>
          <% posts.forEach((post, index) => { %>
          <div class="card mb-4">
            <div class="card-header" id="post<%= index %>Header">
              <%= post.title %>
            </div>
            <div class="card-body">
              <ul class="list-group">
                <% post.aspirants.sort((a, b) => b.votes -
                a.votes).forEach((aspirant) => { %>
                <li
                  class="list-group-item d-flex justify-content-between align-items-center"
                >
                  <%= aspirant.full_name %>
                  <span class="badge badge-primary badge-pill"
                    ><%= aspirant.votes %></span
                  >
                </li>
                <% }) %>
              </ul>
            </div>
          </div>
          <% }) %>
        </div>

        <!-- Section 2: Analysis -->
        <div
          class="tab-pane fade"
          id="section2"
          role="tabpanel"
          aria-labelledby="section2-tab"
        >
          <h2>Analysis</h2>
          <% posts.forEach((post, index) => { %>
          <div class="card mb-4">
            <div class="card-header" id="analysisPost<%= index %>Header">
              <%= post.title %> - Aspirant Votes Distribution
            </div>
            <div class="card-body">
              <canvas
                id="analysisPost<%= index %>Chart"
                width="400"
                height="400"
              ></canvas>
            </div>
          </div>
          <% }) %>
        </div>

        <!-- Section 3: Participants -->
        <div
          class="tab-pane fade"
          id="section3"
          role="tabpanel"
          aria-labelledby="section3-tab"
        >
          <h2>Participants</h2>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>S/N</th>
                <th>Matric Number</th>
                <th>Full Name</th>
              </tr>
            </thead>
            <tbody>
              <% votedStudents.forEach((student, index) => { %>
              <tr>
                <td><%= index + 1 %></td>
                <td><%= student.matric %></td>
                <td><%= student.full_name %></td>
              </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS and jQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <!-- Your additional scripts or customization can go here -->
    <script>
      $(document).ready(function () {
        // Initialize Bootstrap tabs
        $('#adminTabs a').on('click', function (e) {
          e.preventDefault();
          $(this).tab('show');
        });

        // Generate charts for each post in the Analysis tab
        <% posts.forEach((post, index) => { %>
          const analysisPost<%= index %>Data = {
            labels: [<% post.aspirants.forEach((aspirant) => { %>'<%= aspirant.nickname %>', <% }) %>],
            datasets: [{
              label: 'Votes',
              data: [<% post.aspirants.forEach((aspirant) => { %> <%= aspirant.votes %>, <% }) %>],
              backgroundColor: [
                'rgba(255, 99, 132, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(255, 206, 86, 0.5)',
                'rgba(75, 192, 192, 0.5)',
                'rgba(153, 102, 255, 0.5)',
                'rgba(255, 159, 64, 0.5)',
                'rgba(255, 99, 132, 0.5)'
              ],
              borderWidth: 1
            }]
          };

          const analysisCtx<%= index %> = document.getElementById('analysisPost<%= index %>Chart').getContext('2d');
          const analysisPost<%= index %>Chart = new Chart(analysisCtx<%= index %>, {
            type: 'pie',
            data: analysisPost<%= index %>Data,
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: 'top',
                },
                title: {
                  display: true,
                  text: 'Aspirant Votes Distribution'
                }
              }
            }
          });
        <% }) %>
      });
    </script>
  </body>
</html>
